# 前端开发详细检查清单

**原则：细节决定成败** - 所有功能点都要实现到位  
**参考文档：** `REMAINING_WORK_SUMMARY.md`（总体需求梳理和优先级排序）

---

## ✅ Phase 1: 基础功能（已完成）

### Landing Page（基础版）
- [x] 标题 "MOMENT CATCHER"
- [x] TRAVELER ID 输入框
- [x] COMPANION ID 输入框
- [x] INITIATE LINK 按钮
- [x] 表单验证（不能为空）
- [x] 深色科幻风格

### Landing Page（需要优化 - P0）
- [ ] **浮现特效**：fade in + scale（0.5s）
- [ ] **标题霓虹发光**：CSS text-shadow + animation（紫蓝色 #9370DB, #667eea）
- [ ] **输入框手写字体**：cursive 样式
- [ ] **输入框激活状态**：下划线变亮蓝色
- [ ] **点击 INITIATE LINK 跳转主页面**

### 主界面（Tab导航 - 需要重构为三按钮布局）
- [x] 三个 Tab：对话 / Memories / 设置（当前版本）
- [x] Tab 切换功能
- [x] 当前 Tab 高亮显示

### 主界面（已重构 - P0）
- [x] **三个主按钮布局**（底部水平排列）
  - 左：MEMORIES（网格图标）
  - 中：对话按钮（麦克风图标，最大最突出）
  - 右：CAPTURE（星形图标）
- [x] **设置按钮**：右上角（齿轮图标）
- [x] **状态显示系统**（5块信息，从上到下垂直分布，不遮挡）：
  1. **音频处理状态**（顶部）
     - "RECEIVING..."（正在接收）
     - "PROCESSING..."（正在处理）
     - "LINK ACTIVE"（链接可用）
     - 样式：小号灰色科幻字体，圆角按钮
  2. **情绪状态**（第二层）
     - 显示当前情绪：Joy（黄色）、Sadness（蓝色）等
     - 样式：大号手写风格字体，发光效果
     - 颜色：对应情绪颜色
  3. **最近说话人**（第三层）
     - 显示用户自定义名字：TRAVELER 名字或 COMPANION 名字
     - 位置：情绪下方，字幕上方
     - 样式：小号白色科幻字体
  4. **实时字幕**（第四层）
     - 位置：中下部分，主按钮上方，说话人下方
     - 样式：滚动字幕式，不超过三行
     - 内容：实时显示对话内容
     - 样式：白色文字，深灰色背景框
  5. **主按钮**（第五层，底部）
     - 麦克风按钮（最大最突出）
     - 录音中：黄色发光，脉冲动画

### 对话界面（文字输入版本 - 已完成）
- [x] 状态栏显示
- [x] 消息列表（用户 + Agent）
- [x] 文字输入框
- [x] 发送按钮（Enter 键支持）
- [x] 音频播放器（TTS）
- [x] "开始新 Moment" 按钮
- [x] "保存 Moment" 按钮
- [x] 加载状态显示
- [x] 错误处理

### Capture 弹窗（需要实现 - P0）
- [ ] 点击 CAPTURE 按钮后，悬浮弹窗出现在主页面上方
- [ ] 弹窗内容：
  - 问题："Freeze this moment?"（手写字体）
  - 两个按钮：
    - "CRYSTALLIZE"（蓝色背景，主要操作）
    - "FADE"（深灰色背景，取消）
- [ ] 背景：主页面内容可见但模糊（backdrop blur）
- [ ] 点击 CRYSTALLIZE 触发保存 Moment

### Memories 列表（基础版 - 需要重构为星轨图）
- [x] 显示所有 Moments
- [x] Moment Card 信息（日期、情绪、标题、总结）
- [x] 刷新按钮
- [x] 空状态提示

### Memories（Memory Nebula - 需要实现 - P0）
- [ ] **星轨图背景**（暂时纯黑，后续替换为星轨素材）
- [ ] **无 Moment 时**：
  - 左上角显示："MEMORY NEBULA"
  - 下方："AWAITING FRAGMENTS..."
  - 星体：默认颜色（灰色）
- [ ] **有 Moment 时**：
  - 左上角显示："MEMORY NEBULA"
  - 下方："X FRAGMENTS FOUND"
  - 提示："Click a star to recall..."（斜体）
  - 星体：**由近到远按颜色点亮**
    - 最近的有颜色（对应最近的 Moment Card）
    - 颜色 = Moment Card 的颜色（情绪颜色）
    - 远的星体保持默认颜色
- [ ] **交互**：
  - 点击星体 → 打开对应的 Moment Card
  - 底部按钮："RETURN TO ORBIT"（返回主页面）

### Moment Card（基础版已完成）
- [x] **浮现动画**：卡片逐渐浮现（fade in + scale，0.6s）
- [x] **卡片样式**：
  - 深灰色圆角矩形
  - **左侧彩色边框**（颜色 = 情绪颜色）
  - 标题：大号手写风格字体，白色
  - 日期：小号科幻字体，右上角（如 "2025/12/15"）
  - 正文：手写风格字体，白色，多行（第一人称叙事）
  - 关闭按钮：右上角 X 图标
- [x] **背景**：黑色，有模糊的光效（紫色/蓝色）
- [x] **内容包含**：标题、日期、正文

### 设置页面（基础版 - 需要优化）
- [x] 用户信息显示
- [x] 风格画像查看
- [x] 加载状态

### 设置页面（已优化 - P0）
- [x] 显示当前 TRAVELER 和 COMPANION 名字
- [x] 名字显示：手写字体 + 渐变颜色
  - COMPANION：紫色-粉色渐变
  - TRAVELER：蓝色-紫色渐变
- [x] 可编辑输入框（参考 Landing Page 设计）
- [x] 点击名字进入编辑模式
- [x] 保存/取消按钮
- [x] 重命名功能（调用后端 API `/api/update-names`）
- [x] 后端重命名逻辑：重命名所有相关用户数据，不删除之前的记录
- [x] 前端状态更新（更新 userInfo）
- [x] 错误和成功消息提示

---

## ⏳ Phase 2: 语音识别（待实现）

### 录音 UI
- [ ] **录音按钮**
  - 样式：圆形按钮，麦克风图标
  - 状态：未录音（灰色） / 录音中（红色，动画）
  - 位置：输入框旁边或下方

- [ ] **录音状态指示**
  - 录音中：按钮变红 + 脉冲动画
  - 显示"正在录音..."文字提示
  - 录音时长显示（可选）

- [ ] **停止录音**
  - 点击停止按钮
  - 或自动停止（最长60秒）

### 麦克风权限
- [ ] **权限请求**
  - 首次点击录音时请求权限
  - 权限被拒绝时的友好提示
  - 引导用户到浏览器设置

- [ ] **权限状态检查**
  - 页面加载时检查权限状态
  - 显示权限状态提示

### 音频录制
- [ ] **MediaRecorder API**
  - 检测浏览器支持
  - 选择音频格式（优先 wav，fallback 到浏览器支持格式）
  - 采样率设置（16000Hz 或 44100Hz）

- [ ] **录音质量**
  - 单声道（mono）
  - 合适的比特率
  - 确保后端 ASR 能识别

### 音频上传和识别
- [ ] **上传到后端**
  - 使用 FormData
  - 文件字段名：`audio_file`
  - 显示上传进度（可选）

- [ ] **ASR 调用**
  - 调用 `/api/asr` 端点
  - 显示"识别中..."状态
  - 错误处理（网络错误、识别失败等）

- [ ] **识别结果显示**
  - 显示识别出的文字
  - 可选：实时字幕滚动效果
  - 识别错误时的提示

### 识别文字处理
- [ ] **自动填入输入框**
  - 识别成功后，文字自动填入输入框
  - 用户可以编辑后再发送
  - 或直接发送（可选：添加"直接发送"按钮）

- [ ] **用户体验优化**
  - 识别完成后，自动 focus 到输入框
  - 识别失败时，保留录音文件（可选：重试按钮）
  - 识别结果可编辑

### 细节优化
- [ ] **录音文件管理**
  - 录音完成后创建 Blob URL
  - 使用完后释放 URL（避免内存泄漏）
  - 临时文件清理

- [ ] **错误处理细节**
  - 网络错误：显示"网络连接失败，请重试"
  - 识别失败：显示"识别失败，请重试"或"请检查音频质量"
  - 权限拒绝：显示"需要麦克风权限，请在浏览器设置中允许"
  - 浏览器不支持：显示"您的浏览器不支持录音功能"

- [ ] **状态管理**
  - 录音状态（idle / recording / processing / success / error）
  - 禁用其他操作（录音中不能发送文字消息）
  - 录音完成后恢复

---

## ✅ Phase 3: 视觉效果（部分完成）

### 背景选择功能（基础版已完成）
- [x] **3D传送带选择器**
  - 3D传送带式背景选择器（点击选择，支持左右滑动浏览）
  - 动态加载星体素材文件夹下的所有图片（6张预设星图）
  - 选中背景后下沉动画效果
  - 背景状态管理（每次登录都选背景，从Memories返回不选背景）
  - 背景持久化（保存到localStorage，按用户ID隔离）
- [ ] **优化待完成**
  - 左右滑动选择优化（当前是点击选择，可优化为滑动确认）
  - 保存后成为 Memory Card 的封面（待实现）

### 粒子背景（基础版已完成）
- [x] **Three.js 集成**
  - 安装依赖：`three`
  - 基于背景图生成交互式粒子系统
  - 粒子交互效果（鼠标/触摸移动粒子）
  - 背景图嵌入到聊天主页面
- [ ] **增强待完成**
  - 粒子颜色随情绪变化（后续实现）
  - 粒子数量自适应（移动端减少，后续实现）
  - 波形同步（高级，P2）

### Moment Card 视觉
- [ ] **手写字体**
  - Google Fonts: Caveat 或 Indie Flower
  - 加载字体（@import 或 link）
  - 应用到标题和正文

- [ ] **情绪色背景**
  - 根据 emotion_tag 设置背景色
  - 颜色映射：
    - joy → #FFF9C4（浅黄）
    - sadness → #F3E5F5（浅紫）
    - anger → #FFEBEE（浅红）
    - fear → #E3F2FD（浅蓝）
    - love → #FCE4EC（浅粉）
    - surprise → #FFF3E0（浅橙）
    - neutral → #F5F5F5（浅灰）

- [ ] **卡片样式**
  - 左侧情绪色边框（4px）
  - 圆角（20px）
  - 阴影效果
  - 内边距和间距

- [ ] **动画效果**
  - 弹出动画（scale + fade）
  - 过渡动画（0.5s ease-out）
  - 悬停效果（轻微放大）

- [ ] **布局细节**
  - 左上角时间戳（小字，灰色）
  - 标题（大字号，加粗）
  - 正文（行高 1.6，可读性）
  - 底部消息数（小字）

### 3D Memory Nebula（星空）
- [ ] **Three.js 集成**
  - 安装：`three` + `@react-three/fiber` + `@react-three/drei`
  - 创建 Canvas 组件
  - 基础场景设置（相机、灯光、渲染器）

- [ ] **星星渲染**
  - 每个 Moment = 一个星星
  - 星星颜色 = 情绪颜色
  - 星星大小 = 消息数量（可选）

- [ ] **位置映射**
  - X轴：月份（1-12月）
  - Y轴：日期（1-31日）
  - Z轴：随机深度（营造层次）
  - 或：时间 → 3D 坐标的数学映射

- [ ] **交互功能**
  - 点击星星 → 弹出 Moment Card
  - 拖拽旋转（OrbitControls）
  - 缩放（鼠标滚轮）
  - 悬停高亮

- [ ] **视觉效果**
  - 星星发光效果（Bloom Post-processing）
  - 背景星空（粒子系统）
  - 动画：星星缓慢旋转

### Landing Page 动画
- [ ] **Three.js 行星**
  - 行星模型（SphereGeometry）
  - 纹理贴图（可选）
  - 缓慢旋转动画

- [ ] **相机动画**
  - 初始：远距离
  - 过渡：慢慢拉近（2-3秒）
  - 最终：显示名字输入弹窗

- [ ] **弹窗动画**
  - 从透明到不透明（fade in）
  - 轻微缩放效果
  - 玻璃态效果（backdrop-filter）

---

## ⏳ Phase 4: BGM 系统（待实现）

### 情绪 → BGM 映射
- [ ] **BGM 文件准备**
  - 准备不同情绪的 BGM 文件
  - 格式：mp3 或 ogg（兼容性）
  - 文件命名：`bgm_joy.mp3`, `bgm_sadness.mp3` 等

- [ ] **BGM 映射表**
  - joy → uplifting.mp3
  - sadness → melancholic.mp3
  - anger → intense.mp3
  - fear → ambient.mp3
  - love → warm.mp3
  - surprise → dynamic.mp3
  - neutral → ambient.mp3

### 播放控制
- [ ] **Howler.js 集成**
  - 安装：`howler`
  - 创建 BGM 管理器
  - 循环播放

- [ ] **自动切换**
  - 检测当前对话的情绪
  - 情绪变化时切换 BGM
  - 平滑过渡（Fade In/Out，3秒）

- [ ] **音量控制**
  - Agent 说话时：BGM 音量降低 30%
  - Agent 说完后：BGM 音量恢复
  - 用户可手动调节（可选）

- [ ] **用户控制**
  - BGM 开关按钮
  - 音量滑块
  - 静音按钮

---

## ⏳ Phase 5: PWA 配置（待实现）

### Manifest.json
- [ ] **应用信息**
  - 名称：Moment Catcher
  - 短名称：MC
  - 描述：AI 陪伴 Agent
  - 图标：准备不同尺寸的图标（192x192, 512x512）

- [ ] **显示模式**
  - display: "standalone"
  - theme_color: 深色主题色
  - background_color: 背景色

### Service Worker
- [ ] **缓存策略**
  - 静态资源缓存（CSS, JS, 图片）
  - API 请求缓存（可选）
  - 离线页面

- [ ] **更新机制**
  - 检测更新
  - 提示用户刷新
  - 后台更新

### 安装提示
- [ ] **安装横幅**
  - 检测是否可安装
  - 显示安装提示
  - 引导用户安装

---

## ⏳ Phase 6: 响应式和优化（待实现）

### 响应式布局
- [ ] **移动端适配**
  - 断点：375px, 768px, 1024px
  - 移动端：单列布局
  - 桌面端：多列布局

- [ ] **触摸优化**
  - 按钮大小（最小 44x44px）
  - 手势支持（滑动、捏合）
  - 移动端粒子数量减少

### 性能优化
- [ ] **代码分割**
  - 路由懒加载
  - 组件懒加载
  - 3D 场景按需加载

- [ ] **资源优化**
  - 图片懒加载
  - 音频预加载（可选）
  - 字体子集化

- [ ] **渲染优化**
  - 粒子数量限制（移动端 < 100）
  - 3D 场景 LOD（Level of Detail）
  - 帧率监控（保持 60fps）

### 错误处理和用户体验
- [ ] **错误边界**
  - React Error Boundary
  - 错误页面
  - 错误日志（可选：发送到后端）

- [ ] **加载状态**
  - 骨架屏（Skeleton）
  - 加载动画
  - 进度指示

- [ ] **离线支持**
  - 离线检测
  - 离线提示
  - 离线功能（查看已缓存的 Moments）

---

## 📝 技术细节备忘

### API 调用细节
- [ ] **错误处理**
  - 网络错误：显示友好提示
  - 400/500 错误：显示具体错误信息
  - 超时处理（30秒超时）

- [ ] **请求重试**
  - 失败自动重试（最多3次）
  - 指数退避策略

- [ ] **Loading 状态**
  - 每个 API 调用都有 loading 状态
  - 禁用相关按钮（防止重复提交）

### 状态管理细节
- [ ] **Zustand Store**
  - userInfo（用户信息）
  - currentMomentId（当前 Moment）
  - messages（对话历史）
  - moments（所有 Moments）
  - audioUrl（当前音频）
  - recordingState（录音状态）

### 音频处理细节
- [ ] **TTS 音频**
  - 自动播放（autoplay）
  - 播放完成事件监听
  - 错误处理（播放失败）

- [ ] **ASR 音频**
  - 录音格式转换（如果需要）
  - 文件大小限制（10MB）
  - 录音时长限制（60秒）

### 样式细节
- [ ] **颜色系统**
  - 主色：#667eea
  - 背景：深色渐变
  - 文字：层次分明（标题/正文/辅助文字）

- [ ] **字体系统**
  - 默认：系统字体栈
  - 标题：Courier New（科幻感）
  - Moment Card：手写字体

- [ ] **间距系统**
  - 统一使用 rem 单位
  - 间距：0.5rem, 1rem, 1.5rem, 2rem

- [ ] **动画系统**
  - 过渡时间：0.3s（快速）, 0.5s（标准）
  - 缓动函数：ease-out（弹出）, ease-in-out（过渡）

---

## 🎯 优先级排序

### P0（核心功能，必须实现）
1. ✅ 基础文字输入对话
2. ⏳ 语音识别（录音 + ASR）
3. ⏳ 粒子背景（基础版）
4. ⏳ Moment Card 视觉优化

### P1（重要功能）
5. ⏳ 3D Memory Nebula（静态版）
6. ⏳ BGM 系统（基础版）
7. ⏳ Landing Page 动画

### P2（增强功能）
8. ⏳ 粒子波形同步
9. ⏳ 3D 星图交互优化
10. ⏳ PWA 配置
11. ⏳ 响应式优化

---

## 🔍 关键细节检查点

### 语音识别
- [ ] 录音格式是否正确（wav优先）
- [ ] 文件大小是否合理（< 10MB）
- [ ] 权限请求是否友好
- [ ] 错误提示是否清晰
- [ ] 识别结果是否可编辑

### 视觉效果
- [ ] 粒子数量是否影响性能
- [ ] 3D 场景是否流畅（60fps）
- [ ] 颜色映射是否正确
- [ ] 动画是否流畅
- [ ] 移动端是否适配

### 用户体验
- [ ] 加载状态是否清晰
- [ ] 错误提示是否友好
- [ ] 操作是否直观
- [ ] 反馈是否及时
- [ ] 离线是否可用

---

**文档版本：** v3  
**最后更新：** 2025-01-XX  
**状态：** UI设计优化和1:1复刻参考代码样式

**更新内容：**
- ✅ 更新主界面状态（三按钮布局、5块状态信息已完成）
- ✅ 更新设置页面状态（重命名功能已完成）
- ✅ 更新背景选择功能状态（3D传送带选择器，基础版已完成）
- ✅ 更新粒子背景状态（Three.js粒子系统，基础版已完成）
- ✅ 更新Memories状态（Canvas 2D星轨图已完成）
- ✅ 更新Moment Card状态（浮现动画、彩色边框已完成）
- ✅ **UI设计优化**（2025-01-XX）：
  - ✅ 右侧浮动操作按钮1:1复刻参考代码（图标形式，hover显示文字REFRESH和ARCHIVE）
  - ✅ 右侧浮动按钮尺寸放大（图标20px，竖线3.5rem，圆点0.5rem，文字0.625rem）
  - ✅ 底部主按钮移除背景填充（所有状态保持transparent背景）
  - ✅ Settings按钮图标替换为参考代码中的Settings图标（lucide-react齿轮图标）
  - ✅ Echoes页（MemoriesView）三行文字样式1:1复刻参考代码：
    - FLIGHT LOGS: serif字体，2.25rem，tracking-[0.4em]，text-white
    - ECHOES CAPTURED IN STREAMS: serif字体，0.75rem，tracking-[0.2em]，text-white/60
    - SYNC TO RECOLLECT...: serif字体，0.625rem，tracking-[0.3em]，text-white/40
  - ✅ Echoes页文字行间距优化（增加margin-bottom，改善布局比例）

